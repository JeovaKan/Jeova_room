# 中断处理过程

## x86下的服务跳转过程

1. 通过一条INT指令进入中断服务，指令给出一条中断向量，CPU通过该向量在中断向量表找到一扇门；
2. 将这个门的DPL与CPU的CPL相比较，CPL必须小于等于DPL。代表当前CPU所处的级别不低于门的级别，从而当前情况可以穿过门；
3. 穿过中断门以后，将目标代码段描述项中的DPL与CPL比较，目标段的DPL必须小于CPU的CPL；
4. 也就是说，当需要穿过中断门的时候，只允许提升或保持CPU级别（0是系统级，3是用户级）。如果两次级别检查中出现一次越级，都会触发一次全免保护异常。

## 中断服务前的堆栈更换

1. 将当前EFLAGS寄存器的内容和返回地址压入堆栈，返回地址由CS寄存器的内容和取指令指针EIP的内容共同组成。如果中断是由异常引起的，还需要将一个异常原因码压入堆栈（如果中断是硬件中断的，那缘由和其对应触发的硬件中断入口是一致的，也有对应的子服务。但是如果由软件异常触发，就需要一个额外的异常码提供给子服务辨识，所以将其压入堆栈）；
2. 中断服务的运行级别，即目标代码段的DPL，与中断发生时CPU的CPL不同，就会引起堆栈更换。





